<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiView - مشغل فيديو متعدد النوافذ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* كل الأنماط السابقة تبقى كما هي */
        /* ... */
        
        /* إضافة أنماط جديدة */
        .url-examples {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .url-examples h4 {
            color: var(--success);
            margin-bottom: 10px;
        }
        
        .example-link {
            display: block;
            padding: 8px 12px;
            background: rgba(255,255,255,0.03);
            margin: 5px 0;
            border-radius: 5px;
            border-right: 3px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .example-link:hover {
            background: rgba(255,255,255,0.08);
            transform: translateX(-5px);
        }
        
        .url-type-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: 10px;
            background: rgba(76, 201, 240, 0.2);
            color: var(--success);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- باقي الهيكل كما هو -->
        
        <!-- في قسم الإدخال، أضف هذا بعد حقل الإدخال -->
        <section class="input-section">
            <!-- ... -->
            
            <div class="url-examples">
                <h4><i class="fas fa-link"></i> أمثلة للروابط المدعومة:</h4>
                
                <div class="example-link" onclick="document.getElementById('videoUrl').value = 'https://www.facebook.com/share/r/1HHhKtUho6/'">
                    https://www.facebook.com/share/r/1HHhKtUho6/
                    <span class="url-type-badge">ريلز مشاركة</span>
                </div>
                
                <div class="example-link" onclick="document.getElementById('videoUrl').value = 'https://www.facebook.com/reel/123456789012345'">
                    https://www.facebook.com/reel/123456789012345
                    <span class="url-type-badge">ريلز مباشر</span>
                </div>
                
                <div class="example-link" onclick="document.getElementById('videoUrl').value = 'https://www.facebook.com/username/videos/123456789012345/'">
                    https://www.facebook.com/username/videos/123456789012345/
                    <span class="url-type-badge">فيديو عادي</span>
                </div>
                
                <div class="example-link" onclick="document.getElementById('videoUrl').value = 'https://www.facebook.com/watch/?v=123456789012345'">
                    https://www.facebook.com/watch/?v=123456789012345
                    <span class="url-type-badge">مشاهدة فيديو</span>
                </div>
            </div>
            
            <!-- ... -->
        </section>
        
        <!-- ... -->
    </div>

    <script>
        // الدوال المعدلة
        
        function isValidFacebookUrl(url) {
            // تنظيف الرابط من الفراغات
            url = url.trim();
            
            // تحقق من أن الرابط يحتوي على facebook.com
            if (!url.includes('facebook.com')) {
                return false;
            }
            
            // قائمة بأنماط روابط فيسبوك المدعومة
            const validPatterns = [
                /facebook\.com\/.*\/videos\//,           // فيديوهات
                /facebook\.com\/watch\/\?v=/,            // مشاهدة فيديو
                /facebook\.com\/reel\//,                 // ريلز مباشر
                /facebook\.com\/.*\/reel\//,             // ريلز من حساب
                /facebook\.com\/share\/r\//,             // رابط مشاركة ريلز
                /facebook\.com\/video\.php\?/,           // فيديو قديم
                /fb\.watch\//,                           // رابط مختصر
                /facebook\.com\/.*\/posts\/.*video/,     // منشور يحتوي فيديو
                /facebook\.com\/photo\.php\?.*video/,    // فيديو في صورة
                /facebook\.com\/.*\/videos\/.*/,         // فيديو بأي شكل
                /facebook\.com\/.*\/video\.php.*/        // فيديو php
            ];
            
            // التحقق من أي نمط ينطبق
            const isValid = validPatterns.some(pattern => pattern.test(url));
            
            // تحقق إضافي للتأكد
            if (isValid) {
                console.log('تم التحقق من الرابط بنجاح:', url);
                return true;
            }
            
            // إذا كان رابط مشاركة ريلز (مثل رابطك)
            if (url.includes('/share/r/')) {
                console.log('رابط ريلز مشاركة مكتشف');
                return true;
            }
            
            return false;
        }
        
        function getFacebookEmbedUrl(url) {
            let cleanUrl = url.trim();
            
            console.log('معالجة الرابط:', cleanUrl);
            
            // محاولة تحويل روابط الريلز إلى شكل يمكن تضمينه
            if (cleanUrl.includes('/share/r/')) {
                // رابط مشاركة ريلز - محاولة تحويله
                console.log('تحويل رابط مشاركة ريلز...');
                
                // محاولة استخراج معرف الفيديو من رابط المشاركة
                const matches = cleanUrl.match(/\/share\/r\/([^\/]+)/);
                if (matches && matches[1]) {
                    // محاولة إنشاء رابط ريلز مباشر
                    cleanUrl = `https://www.facebook.com/reel/${matches[1]}`;
                    console.log('تم التحويل إلى:', cleanUrl);
                }
            }
            
            // إضافة معلمات التضمين
            const embedUrl = `https://www.facebook.com/plugins/video.php?href=${encodeURIComponent(cleanUrl)}&show_text=0&width=500&height=281&appId`;
            
            console.log('رابط التضمين النهائي:', embedUrl);
            return embedUrl;
        }
        
        // دالة محسنة لعرض التنبيهات
        function showAlert(message, type = 'info') {
            const alertDiv = document.getElementById('alert');
            const alertMessage = document.getElementById('alert-message');
            
            if (!alertDiv || !alertMessage) return;
            
            // إعداد الألوان حسب النوع
            let bgColor, borderColor, icon;
            switch(type) {
                case 'error':
                    bgColor = 'rgba(220, 53, 69, 0.2)';
                    borderColor = 'rgba(220, 53, 69, 0.5)';
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'success':
                    bgColor = 'rgba(25, 135, 84, 0.2)';
                    borderColor = 'rgba(25, 135, 84, 0.5)';
                    icon = 'fas fa-check-circle';
                    break;
                default:
                    bgColor = 'rgba(13, 110, 253, 0.2)';
                    borderColor = 'rgba(13, 110, 253, 0.5)';
                    icon = 'fas fa-info-circle';
            }
            
            alertMessage.innerHTML = `<i class="${icon}"></i> ${message}`;
            alertDiv.style.cssText = `
                display: flex;
                background: ${bgColor};
                border: 1px solid ${borderColor};
                color: white;
                padding: 15px 20px;
                border-radius: 10px;
                margin-bottom: 20px;
                align-items: center;
                gap: 15px;
                animation: fadeIn 0.3s ease;
            `;
            
            // إضافة أنيميشن إذا لم تكن موجودة
            if (!document.querySelector('style#alert-animation')) {
                const style = document.createElement('style');
                style.id = 'alert-animation';
                style.textContent = `
                    @keyframes fadeIn {
                        from { opacity: 0; transform: translateY(-10px); }
                        to { opacity: 1; transform: translateY(0); }
                    }
                    @keyframes fadeOut {
                        from { opacity: 1; transform: translateY(0); }
                        to { opacity: 0; transform: translateY(-10px); }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // إخفاء التنبيه بعد 5 ثواني
            setTimeout(() => {
                alertDiv.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => {
                    alertDiv.style.display = 'none';
                    alertDiv.style.animation = '';
                }, 300);
            }, 5000);
        }
        
        // دالة محسنة لتحميل الفيديو
        loadBtn.addEventListener('click', async function() {
            const url = videoUrl.value.trim();
            
            if (!url) {
                showAlert('الرجاء إدخال رابط فيديو فيسبوك', 'error');
                return;
            }
            
            // إظهار حالة التحميل
            const originalText = loadBtn.innerHTML;
            loadBtn.innerHTML = '<div class="loading"></div> جاري التحقق...';
            loadBtn.disabled = true;
            
            try {
                // التحقق من الرابط
                if (!isValidFacebookUrl(url)) {
                    showAlert('الرجاء إدخال رابط فيسبوك صحيح (فيديو أو ريلز)', 'error');
                    return;
                }
                
                showAlert('جاري تحميل الفيديو في النوافذ المتعددة...', 'info');
                
                currentVideoUrl = url;
                videoCount++;
                totalVideos.textContent = videoCount;
                
                // تفعيل زر تشغيل الكل
                playAllBtn.disabled = false;
                
                // إنشاء النوافذ بعد تأخير بسيط
                setTimeout(() => {
                    createVideoWindows();
                    showAlert(`تم تحميل الفيديو في ${windowCount.value} نافذة بنجاح!`, 'success');
                }, 500);
                
            } catch (error) {
                console.error('خطأ في تحميل الفيديو:', error);
                showAlert(`حدث خطأ: ${error.message}`, 'error');
            } finally {
                // استعادة حالة الزر
                loadBtn.innerHTML = originalText;
                loadBtn.disabled = false;
            }
        });
        
        // عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // تعيين رابط المثال في حقل الإدخال
            document.getElementById('videoUrl').value = 'https://www.facebook.com/share/r/1HHhKtUho6/';
            
            // رسالة ترحيب
            setTimeout(() => {
                showAlert('مرحباً! الموقع يدعم الآن روابط الريلز مثل الرابط الموجود في الحقل', 'info');
            }, 1000);
        });
    </script>
</body>
                    </html>
